{% extends 'base_generic.html' %}


{% block header %}
	<title> C19 Dashboard </title>
{% endblock %}

{% block content %}
	<style>
		form.modalform ul{
			list-style-type:none;
			display: flex;
			flex-direction: column;
			flex-wrap: wrap;
			height: 400px;
			align-items: start;
		}

		form.modalform li{
			width: 220px;
		}
		
		.modal-dialog {
	    	overflow-y: initial !important
		}

		.modal-body {

		    overflow-y: auto;
		    overflow-x: auto;
		}
	</style>

	<div class="container-fluid", style="padding: 5%">
		{% if user.is_authenticated %}

			<div class="container-fluid">
				<h1> My Dashboard </h1>
				<p></p>
				<div style="margin-bottom:60px;">
						Create your own customized data dashboard by selecting specific countries
						<button type="button" class="btn btn-primary float-right" data-toggle="modal" data-target="#country-selection-modal" style="padding:10px;margin-left:50px; margin-top:-10px; vertical-align: middle">Update country selection</button>

						<button type="button" class="btn btn-primary float-right" data-toggle="modal" data-target="#state-selection-modal" style="padding:10px;margin-left:50px; margin-top:-10px; vertical-align: middle">Update state selection</button>
				</div>
			</div>

			<!------------------------------------->
			<!-- COUNTRY SELECTION MODAL STARTS -->
			<div id = "country-selection-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
				<form action = "" method = "POST" class = "modalform"> 
				  <div class="modal-dialog modal-xl">
				    <div class="modal-content">
				    	<div class="modal-header">
				  			<h5 class="modal-title" id="exampleModalLabel">Country-level data to include on dashboard</h5>
				  			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				  				<span aria-hidden="true">&times;</span>
				  			</button>
				  		</div>
			  			<div class="modal-body">		  				
		  					{% csrf_token %}
		  					{{ dashboard_country_filter_form.countries}}

			  			</div>
			  			<div class="modal-footer">
			  				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			  				<button type="submit" class="btn btn-primary"> Save changes </button>
			  			</div>
			  		</div>
				  </div>
				</form>
			</div>
			<!--- COUNTRY SELECTION BUTTON ENDS --->
			<!------------------------------------->


			<!------------------------------------->
			<!--- STATE SELECTION MODAL STARTS ---->
			<div id = "state-selection-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
				<form action = "" method = "POST"> 
				  <div class="modal-dialog modal-xl">
				    <div class="modal-content">
				    	<div class="modal-header">
				  			<h5 class="modal-title" id="exampleModalLabel">State-level data to include on dashboard</h5>
				  			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				  				<span aria-hidden="true">&times;</span>
				  			</button>
				  		</div>
			  			<div class="modal-body">	
			  				{% csrf_token %}
		  					{{ dashboard_state_filter_form.states}}	  				
			  			</div>
			  			<div class="modal-footer">
			  				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			  				<button type="submit" class="btn btn-primary"> Save changes </button>
			  			</div>
			  		</div>
				  </div>
				</form>
			</div>
			<!---- STATE SELECTION BUTTON ENDS ---->
			<!------------------------------------->


			<!------------------------------------->
			<!--------- LINE CHART STARTS --------->

			<div id="container" style="min-width: 310px; max-width:80%; height: 500px; margin: 0 auto" class="border">
				<script src="https://code.highcharts.com/highcharts.js"> </script>
				<script src="https://code.highcharts.com/modules/exporting.js"> </script>
				<script src="https://code.highcharts.com/modules/export-data.js"> </script>
				<script src="https://code.highcharts.com/modules/accessibility.js"></script>

				<script>
					_dates = {{ dates|safe }};
					_c1 = {{ country_1|safe }};
					_c2 = {{country_2|safe}};
					_c3 = {{country_3|safe}};
					_c4 = {{country_4|safe}};
					_c5 = {{country_5|safe}};
					_c6 = {{country_6|safe}};
					_c1name = {{country_1_name|safe}}
					_c2name = {{country_2_name|safe}}
					_c3name = {{country_3_name|safe}}
					_c4name = {{country_4_name|safe}}
					_c5name = {{country_5_name|safe}}
					_c6name = {{country_6_name|safe}}
					_s1 = {{ state_1|safe }};
					_s2 = {{ state_2|safe }};
					_s3 = {{ state_3|safe }};
					_s4 = {{ state_4|safe }};
					_s5 = {{ state_5|safe }};
					_s6 = {{ state_6|safe }};
					_s1name = {{state_1_name|safe}};
					_s2name = {{state_2_name|safe}};
					_s3name = {{state_3_name|safe}};
					_s4name = {{state_4_name|safe}};
					_s5name = {{state_5_name|safe}};
					_s6name = {{state_6_name|safe}};
					
					Highcharts.chart('container', {
						chart: {type: 'line'},
						rangeSelector: { selected: 4},
						title: {text: 'Cummulative Confirmed Cases', style: {fontSize:"24px"}},
						subtitle: {text: 'Data from Johns Hopkins'},
					  	xAxis: {categories: _dates},
					  	yAxis: {
					  		title: {text: '# Confirmed Cases'}
					  	},
					  	plotOptions: {
					  		series: {marker: {radius: 1}}
					  	},
						series: [
							{name: _c1name, data: _c1},
							{name: _c2name, data: _c2},
							{name: _c3name, data: _c3},
							{name: _c4name, data: _c4},
							{name: _c5name, data: _c5},
							{name: _c6name, data: _c6},
							{name: _s1name, data: _s1},
							{name: _s2name, data: _s2},
							{name: _s3name, data: _s3},
							{name: _s4name, data: _s4},
							{name: _s5name, data: _s5},
							{name: _s6name, data: _s6},
						]
					})
				</script>

			<!---------- LINE CHART ENDS ---------->
			<!------------------------------------->




		{% else %}
			<strong> Please <a href="{% url 'login' %}"> log in </a> or <a href="{% url 'signup' %}"> sign up </a>to create your personalized dashboard for COVID-19 data </strong>
		{% endif %}
	</div>


{% endblock %}